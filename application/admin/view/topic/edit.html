<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专辑管理 | Nifty - Admin ThinkPHP</title>
    <!--STYLESHEET-->
    <link href="__LAYUI__css/layui.css" rel="stylesheet" >
    <link href='__ADMIN__css/font-face.css' rel='stylesheet' type='text/css'>
    <link href="__ADMIN__css/bootstrap.min.css" rel="stylesheet">
    <link href="__ADMIN__css/nifty.min.css" rel="stylesheet">
    <link href="__ADMIN__css/demo/nifty-demo-icons.min.css" rel="stylesheet">
    <link href="__ADMIN__css/demo/nifty-demo.min.css" rel="stylesheet">
    <link href="__ADMIN__plugins/magic-check/css/magic-check.min.css" rel="stylesheet">
    <link href="__ADMIN__plugins/bootstrap-select/bootstrap-select.min.css" rel="stylesheet">
    <link href="__ADMIN__plugins/bootstrap-tagsinput/bootstrap-tagsinput.min.css" rel="stylesheet">
    <link href="__ADMIN__plugins/select2/css/select2.min.css" rel="stylesheet">
    <link href="__ADMIN__plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="__ADMIN__plugins/ionicons/css/ionicons.min.css" rel="stylesheet">
    <link href="__ADMIN__plugins/morris-js/morris.min.css" rel="stylesheet">
    <link href="__ADMIN__plugins/summernote/summernote.min.css" rel="stylesheet">
    <link href="__ADMIN__plugins/pace/pace.min.css" rel="stylesheet">

    <!--JAVASCRIPT-->
    <script src="__ADMIN__js/jquery-2.2.4.min.js"></script>
    <script src="__ADMIN__js/jquery.cookie.js"></script>
    <script src="__ADMIN__js/bootstrap.min.js"></script>
    <script src="__ADMIN__js/nifty.min.js"></script>
    <script src="__ADMIN__js/demo/nifty-demo.min.js"></script>
    <script src="__ADMIN__plugins/pace/pace.min.js"></script>
    <script src="__LAYUI__layui.js"></script>
    <script src="__ADMIN__plugins/validform/validform.js"></script>
    <script src="__ADMIN__plugins/bootstrap-select/bootstrap-select.min.js"></script>
    <script src="__ADMIN__plugins/select2/js/select2.min.js"></script>
    <script src="__ADMIN__plugins/bootbox/bootbox.min.js"></script>
    <script src="__ADMIN__plugins/summernote/summernote.min.js"></script>
    <script src="__ADMIN__plugins/summernote/lang/summernote-zh-CN.js"></script>
    <script src="__ADMIN__js/myself.min.js"></script>
</head>
<body>
    <div id="container" class="effect aside-float aside-bright mainnav-lg">
        <!--NAVBAR-->
        {include file="static/admin/navbar.html"}
        <!--END NAVBAR-->
        <div class="boxed">
            <!--CONTENT CONTAINER-->
            <div id="content-container">
                <!--Page Title-->
                <div id="page-title">
                    <h1 class="page-header text-overflow">歌单管理</h1>
                    <!--Searchbox-->
                    <div class="searchbox">
                        <div class="input-group custom-search-form">
                            <input type="text" class="form-control" placeholder="Search..">
                            <span class="input-group-btn">
                                <button class="text-muted" type="button"><i class="demo-pli-magnifi-glass"></i></button>
                            </span>
                        </div>
                    </div>
                </div>
                <!--End page title-->
                <!--Breadcrumb-->
                <ol class="breadcrumb">
                    <li><a href="{:url('/admin')}">首页</a></li>
                    <li><a href="{:url('topic/index')}">列表</a></li>
                    <li class="active">{lt name=":input('param.id')" value="0"}新增{else/}编辑{/lt}</li>
                </ol>
                <!--End breadcrumb-->
                <!--Page content-->
                <div id="page-content">
					<div class="row">
                        <form method="post" action="{:url('topic/save')}">
                            <div class="col-lg-12">
                                <div class="panel">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">歌单管理</h3>
                                    </div>
                                    <!-- BASIC FORM ELEMENTS -->
                                    <div class="panel-body form-horizontal form-padding">
                                        <!--text-->
                                        <div class="form-group">
                                            <label class="col-md-3 control-label">歌单名称</label>
                                            <div class="col-md-5">
                                                <input type="text" class="form-control" name="name" value="{$Obj->name}" placeholder="歌单名称" datatype="*"  nullmsg="单页面的标题不能为空">
                                            </div>
                                        </div>

                                        <!--text-->
                                        <div class="form-group">
                                            <label class="col-md-3 control-label">封面图</label>
                                            <div class="col-md-5 input-group">
                                                <input type="text" class="form-control data-cropper" name="photo" value="{$Obj->photo}" onclick="viewPhoto(this, '.data-cropper')">
                                                <span class="input-group-addon"><a href="JavaScript:void(0)" class="fa fa-upload" onclick="cropper(this)"></a></span>
                                            </div>
                                        </div>

                                        <!--text-->
                                        <div class="form-group">
                                            <label class="col-md-3 control-label">标签</label>
                                            <div class="col-md-5 input-group">
                                                <input type="text" class="form-control" placeholder="" name="tags" value="{$Obj->tags}">
                                                <span class="input-group-addon"><a href="JavaScript:void(0)" onclick="getTags('name','tags')" class="fa fa-cloud"></a></span>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="col-md-3 control-label">简介</label>
                                            <div class="col-md-7">
                                                <textarea id="content" name="desc">{$Obj->desc}</textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="panel-footer text-right">
                                        <input type="hidden" name="id" value="{$Obj->id}">
                                        <button class="btn btn-purple" type="button" onclick="addMusic()">添加歌曲</button>
                                        <button class="btn btn-success" type="submit">提交</button>
                                    </div>
                                </div>

                                <div class="panel">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">所有歌曲</h3>
                                    </div>
                                    <!-- END BASIC FORM ELEMENTS -->
                                    <div class="table-responsive">
                                        <table id="demo-foo-addrow" class="table table-bordered table-hover toggle-circle" data-page-size="7">
                                            <thead>
                                            <tr>
                                                <th width="20"></th>
                                                <th width="100">ID</th>
                                                <th>歌曲</th>
                                                <th>添加时间</th>
                                                <th width="150">操作</th>
                                            </tr>
                                            </thead>
                                            <tbody id="musicList">
                                            {volist name='list' id='item' key='key' empty='暂无数据'}
                                            <tr>
                                                <td>
                                                    <input id="checkbox-{$key}" class="magic-checkbox" type="checkbox" value="{$item.id}" >
                                                    <label for="checkbox-{$key}"></label>
                                                </td>
                                                <td>{$item.id}</td>
                                                <td>{$item.title|str_cut=###,20}</td>
                                                <td>{$item.rel_create_time|date="Y-m-d H:i:s",###}</td>
                                                <td>
                                                    <div class="btn-group">
                                                        <a href="{:url('/admin/topic/delMusic', ['id'=> $item.rel_id])}" class="btn btn-danger btn-xs">删除</a>
                                                    </div>
                                                </td>
                                            </tr>
                                            {/volist}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="text-right">
                                    {$list->render()}
                                </div>
                            </div>
                        </form>
					</div>

                </div>
                <!--End page content-->
            </div>
            <!--END CONTENT CONTAINER-->
            <!--ASIDE-->
            {include file="static/admin/aside.html"}
            <!--END ASIDE-->
            <!--MAIN NAVIGATION-->
            {include file="static/admin/menu.html"}
            <!--END MAIN NAVIGATION-->
        </div>
        <!-- FOOTER -->
        {include file="static/admin/footer.html"}
        <!-- END FOOTER -->
        <!-- SCROLL PAGE BUTTON -->
        <button class="scroll-top btn">
            <i class="pci-chevron chevron-up"></i>
        </button>
    </div>
    <!-- END OF CONTAINER -->
    <script>
        $("#content").summernote({
            height : '230px',lang:"zh-CN"
        });
        $(".demoform").Validform({tiptype:3});
        layui.use(['layer'],function () {
            var layer = layui.layer;
        })
        function upload() {
            var index = layer.open({
                id: 100,
                btn:['确定'],
                maxmin: true,
                title: "文件上传",
                type: 2,
                shade: 0.8,
                area: ['700px', '500px'],
                content: "/admin/upload/index",
                yes:function () {
                    var name = layer.getChildFrame("#data-upload", index).val(); //获取打开窗口的元素
                    name = name.substring(0,name.length-1);
                    $(".data-upload").val(name);
                    layer.close(index);
                }
            })
        }
        function addMusic() {
            var topic = $("input[name=id]").val();
            var music = layer.open({
                id: 100,
                btn:['确定添加'],
                maxmin: true,
                title: "歌单歌曲",
                type: 2,
                shade: 0.8,
                area: ['80%', '90%'],
                content: "/admin/topic/setMusic",
                yes:function () {
                    var input = layer.getChildFrame("input[type=checkbox]:checked", music);
                    var ids = '';
                    input.each(function (e,v) {
                        ids += $(v).val() + ',';
                    })
                    ids = ids.substring(0,ids.length-1);
                    $("input[name='musicId']").val(ids);
                    $.post("/admin/topic/saveMusic",{id:ids,topic:topic},function (data) {
                        if(data.code == 'SUCCESS'){
                            layer.close(music);
                            layer.msg(data.msg,{icon:1,time:2000},function () {
                                window.location.reload();
                            });
                        }else{
                            layer.msg(data.msg);
                            return false;
                        }
                    })
                }
            })

        }
    </script>
</body>
</html>
